{"version":3,"file":"index.d.cts","names":["Redis","StorageOptionsType","StorageOptions","StorageRedisOptions","StorageMemoryOptions","References","LoggerInput","Logger","DataTransformer","Events","StorageInputRedis","StorageInputMemory","StorageInterface","Promise","createCache","Cache","T","N","S","ReturnType","Awaited","Parameters","createStorage"],"sources":["../../../node_modules/.pnpm/async-cache-dedupe@2.2.0/node_modules/async-cache-dedupe/index.d.ts","../src/env.ts","../src/index.ts"],"sourcesContent":["import { Redis } from \"ioredis\";\n\nexport type StorageOptionsType = \"redis\" | \"memory\";\n\nexport type StorageOptions = {\n  type: StorageOptionsType,\n  options: StorageRedisOptions | StorageMemoryOptions,\n}\n\ntype References = string | string[];\n\ninterface LoggerInput {\n  msg: string;\n  [key: string]: any;\n}\n\ninterface Logger {\n  debug: (input: LoggerInput) => void;\n  warn: (input: LoggerInput) => void;\n  error: (input: LoggerInput) => void;\n}\nexport interface StorageRedisOptions {\n  client: Redis;\n  log?: Logger;\n  invalidation?: { referencesTTL: number } | boolean;\n}\n\nexport interface StorageMemoryOptions {\n  size?: number;\n  log?: Logger;\n  invalidation?: boolean;\n}\n\ninterface DataTransformer {\n  serialize: (data: any) => any;\n  deserialize: (data: any) => any;\n}\n\ntype Events = {\n  onDedupe?: (key: string) => void;\n  onError?: (err: any) => void;\n  onHit?: (key: string) => void;\n  onMiss?: (key: string) => void;\n};\n\nexport type StorageInputRedis = {\n  type: \"redis\";\n  options?: StorageRedisOptions;\n};\n\nexport type StorageInputMemory = {\n  type: \"memory\";\n  options?: StorageMemoryOptions;\n};\n\nexport declare class StorageInterface {\n  constructor(options: any);\n\n  get(key: string): Promise<undefined | any>;\n  set(key: string, value: any, ttl: number, references?: References): Promise<void>;\n  remove(key: string): Promise<void>;\n  invalidate(references: References): Promise<void>;\n  clear(name: string): Promise<void>;\n  refresh(): Promise<void>;\n}\n\nexport declare function createCache(\n  options?: {\n    storage?: StorageInputRedis | StorageInputMemory;\n    ttl?: number | ((result: unknown) => number);\n    transformer?: DataTransformer;\n    stale?: number | ((result: unknown) => number);\n  } & Events,\n): Cache;\n\nexport declare class Cache {\n  constructor(\n    options: {\n      ttl: number | ((result: unknown) => number);\n      stale?: number | ((result: unknown) => number);\n      storage: StorageInterface;\n    } & Events\n  );\n\n  define<T extends (args: any) => any, N extends string, S extends this>(\n    name: N,\n    opts: {\n      storage?: StorageOptions;\n      transformer?: DataTransformer;\n      ttl?: number | ((result: Awaited<ReturnType<T>>) => number);\n      stale?: number | ((result: Awaited<ReturnType<T>>) => number);\n      serialize?: (...args: any[]) => any;\n      references?: (\n        args: Parameters<T>[0],\n        key: string,\n        result: Awaited<ReturnType<T>>\n      ) => References | Promise<References>;\n    } & Events,\n    func?: T\n  ): S & { [n in N]: T };\n  define<T extends (args: any) => any, N extends string, S extends this>(\n    name: N,\n    opts: T\n  ): S & { [n in N]: T };\n\n  clear(): Promise<void>;\n  clear(name: string): Promise<void>;\n  clear(name: string, value: any): Promise<void>;\n\n  get(name: string, key: string): Promise<any>;\n\n  set(\n    name: string,\n    key: string,\n    value: any,\n    ttl: number,\n    references?: References\n  ): Promise<void>;\n\n  invalidate(name: string, references: References): Promise<void>;\n\n  invalidateAll(\n    references: References,\n    storage?: StorageOptionsType\n  ): Promise<void>;\n}\n\nexport declare function createStorage(type: \"redis\", options: StorageRedisOptions): StorageInterface;\nexport declare function createStorage(type: \"memory\", options: StorageMemoryOptions): StorageInterface;\nexport declare function createStorage(\n  type: StorageOptionsType,\n  options: StorageRedisOptions | StorageMemoryOptions,\n): StorageInterface;\n\n"],"x_google_ignoreList":[0],"mappings":"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"}